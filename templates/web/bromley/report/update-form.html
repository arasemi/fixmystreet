[% allow_creation = !c.cobrand.only_authed_can_create || (c.user && c.user.from_body) %]
[% RETURN IF NOT allow_creation OR problem.extra.closed_updates %]

<div id="update_form">
  [% UNLESS hide_header %]
    <h2[% IF two_column_sidebar %] class="hidden-js"[% END %]>[% loc('Provide an update') %]</h2>
  [% END %]

    [% INCLUDE 'errors.html' %]

    <form method="post" action="[% c.uri_for( '/report/update' ) %]" id="form_update_form" name="updateForm" class="validate"[% IF c.cobrand.allow_photo_upload %] enctype="multipart/form-data"[% END %]>
        <input type="hidden" name="token" value="[% csrf_token %]">
        <fieldset>
          [% IF NOT login_success AND NOT oauth_need_email %]
            [% INCLUDE 'report/update/form_update.html' %]
          [% END %]
          [% IF c.user_exists %]
            [% PROCESS 'report/update/form_user_loggedin.html' %]
          [% ELSIF oauth_need_email %]
            [% INCLUDE 'report/update/form_user_loggedout_email.html' required = 1 %]
            <div id="form_sign_in">
                <h3>[% loc("Now to submit your update&hellip;") %]</h3>
                <h2>[% tprintf(loc("Do you have a %s password?", "%s is the site name"), site_name) %]</h2>
                [% INCLUDE 'report/update/form_user_loggedout_by_email.html' %]
                [% INCLUDE 'report/update/form_user_loggedout_password.html' %]
                <input type="hidden" name="oauth_need_email" value="1">
            </div>
          [% ELSE %]
            [% INCLUDE 'report/update/form_user_loggedout.html' %]
          [% END %]

            <p>Your information will only be used in accordance with our <a href="/faq#privacy">privacy policy</a>.</p>

          [% IF login_success OR oauth_need_email %]
            [% INCLUDE 'report/update/form_update.html' %]
          [% END %]
        </fieldset>
    </form>
</div>
